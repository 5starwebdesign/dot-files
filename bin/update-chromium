#!/bin/bash
# Script for auto-updating chrome nightly builds
# Once in a while this will need updating. They like to move the source periodically.
# See: http://top-frog.com/2010/05/29/automatically-download-chromium-nightly-builds/ for info

LATEST=`curl -s http://commondatastorage.googleapis.com/chromium-browser-continuous/Mac/LAST_CHANGE`
CHROMEURL="http://commondatastorage.googleapis.com/chromium-browser-continuous/Mac/$LATEST/chrome-mac.zip"
echo "Fetching $CHROMEURL"
/usr/bin/curl -L "$CHROMEURL" -o /tmp/chrome-mac.zip
wait

echo "Unzipping"
/usr/bin/unzip -o -qq /tmp/chrome-mac.zip -d /tmp
wait

echo "Stopping existing Chromium (if necessary) and moving old file to trash"
/usr/bin/osascript -e "
tell application \"System Events\"
  if exists (some process whose name contains \"Chromium\") then
    tell application \"Chromium\" to quit
  end if
end tell
tell application \"Finder\"
  if exists (file \"Chromium.app\" in folder \"Applications\" of startup disk)
    move file \"Chromium.app\" in folder \"Applications\" of startup disk to trash
  end if
end tell"

echo "Moving new Chromium in to place"
/bin/cp -Rf /tmp/chrome-mac/Chromium.app /Applications
wait

echo "Cleaning up"
/bin/rm -rf /tmp/chrome-*

echo "Done"
open /Applications/Chromium.app
exit 0